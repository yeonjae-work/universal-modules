name: Universal Modules CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

permissions:
  contents: write
  pull-requests: write
  pages: write

env:
  PYTHON_VERSION: "3.11"
  # GitHub ì´ë©”ì¼ ì•Œë¦¼ ë¹„í™œì„±í™”
  ACTIONS_RUNNER_DEBUG: false
  ACTIONS_STEP_DEBUG: false

jobs:
  # ë³€ê²½ëœ ëª¨ë“ˆ ê°ì§€
  detect-changes:
    name: "ë³€ê²½ëœ ëª¨ë“ˆ ê°ì§€"
    runs-on: ubuntu-latest
    outputs:
      changed-modules: ${{ steps.changes.outputs.modules }}
      matrix: ${{ steps.changes.outputs.matrix }}
      has-changes: ${{ steps.changes.outputs.has-changes }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ë³€ê²½ëœ ëª¨ë“ˆ ê°ì§€
        id: changes
        run: |
          # ëª¨ë“  ëª¨ë“ˆ ëª©ë¡ì„ packages ë””ë ‰í„°ë¦¬ì—ì„œ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
          all_modules=$(ls -1 packages/ | tr '\n' ' ' | sed 's/ $//')
          echo "ğŸ” ì „ì²´ ëª¨ë“ˆ: $all_modules"
          
          # ë³€ê²½ëœ íŒŒì¼ í™•ì¸
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            # PRì˜ ê²½ìš° base ë¸Œëœì¹˜ì™€ ë¹„êµ
            base_sha="${{ github.event.pull_request.base.sha }}"
            head_sha="${{ github.event.pull_request.head.sha }}"
            changed_files=$(git diff --name-only $base_sha..$head_sha)
          else
            # Pushì˜ ê²½ìš° ì´ì „ ì»¤ë°‹ê³¼ ë¹„êµ
            if [ "${{ github.event.before }}" != "0000000000000000000000000000000000000000" ]; then
              changed_files=$(git diff --name-only ${{ github.event.before }}..${{ github.sha }})
            else
              # ì²« ë²ˆì§¸ ì»¤ë°‹ì¸ ê²½ìš° ëª¨ë“  íŒŒì¼
              changed_files=$(git ls-files)
            fi
          fi
          
          echo "ğŸ“„ ë³€ê²½ëœ íŒŒì¼ë“¤:"
          echo "$changed_files"
          
          # ë³€ê²½ëœ ëª¨ë“ˆ ì¶”ì¶œ
          changed_modules=""
          for module in $all_modules; do
            if echo "$changed_files" | grep -q "packages/$module/"; then
              if [ -z "$changed_modules" ]; then
                changed_modules="$module"
              else
                changed_modules="$changed_modules $module"
              fi
              echo "ğŸ“¦ ë³€ê²½ ê°ì§€: $module"
            fi
          done
          
          # CI/CD ê´€ë ¨ íŒŒì¼ì´ ë³€ê²½ëœ ê²½ìš° ëª¨ë“  ëª¨ë“ˆ ì²˜ë¦¬
          if echo "$changed_files" | grep -E "(\.github/workflows|scripts/|Makefile|pyproject\.toml)"; then
            echo "ğŸ”§ CI/CD íŒŒì¼ ë³€ê²½ ê°ì§€ - ëª¨ë“  ëª¨ë“ˆ ì²˜ë¦¬"
            changed_modules="$all_modules"
          fi
          
          # ë³€ê²½ëœ ëª¨ë“ˆì´ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
          if [ -z "$changed_modules" ]; then
            echo "ğŸ“„ ë³€ê²½ëœ ëª¨ë“ˆ ì—†ìŒ"
            echo "modules=" >> $GITHUB_OUTPUT
            echo "matrix={\"include\":[]}" >> $GITHUB_OUTPUT
            echo "has-changes=false" >> $GITHUB_OUTPUT
          else
            echo "ğŸ“¦ ë³€ê²½ëœ ëª¨ë“ˆ: $changed_modules"
            echo "modules=$changed_modules" >> $GITHUB_OUTPUT
            
            # Matrix ì „ëµì„ ìœ„í•œ JSON ìƒì„± (í•œ ì¤„ë¡œ)
            matrix_json='{"include":['
            first=true
            for module in $changed_modules; do
              if [ "$first" = true ]; then
                first=false
              else
                matrix_json="$matrix_json,"
              fi
              matrix_json="$matrix_json{\"module\":\"$module\"}"
            done
            matrix_json="$matrix_json]}"
            
            echo "matrix=$matrix_json" >> $GITHUB_OUTPUT
            echo "has-changes=true" >> $GITHUB_OUTPUT
            echo "âœ… ë§¤íŠ¸ë¦­ìŠ¤ JSON: $matrix_json"
          fi

  # ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
  quality-check:
    name: "ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬"
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.has-changes == 'true'
    strategy:
      matrix: ${{ fromJson(needs.detect-changes.outputs.matrix) }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          cd packages/${{ matrix.module }}
          python -m pip install --upgrade pip
          pip install -e ".[dev]" || pip install -e .

      - name: ì½”ë“œ í¬ë§·íŒ… ê²€ì‚¬ (Black)
        run: |
          cd packages/${{ matrix.module }}
          pip install black
          black --check --diff src/ tests/ || true
      
      - name: Import ì •ë ¬ ê²€ì‚¬ (isort)
        run: |
          cd packages/${{ matrix.module }}
          pip install isort
          isort --check-only --diff src/ tests/ || true
      
      - name: ë¦°íŒ… (flake8)
        run: |
          cd packages/${{ matrix.module }}
          pip install flake8
          flake8 src/ tests/ --max-line-length=88 --extend-ignore=E203,W503 || true

  # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  test:
    name: "í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
    runs-on: ubuntu-latest
    needs: [detect-changes, quality-check]
    if: needs.detect-changes.outputs.has-changes == 'true'
    strategy:
      matrix: 
        python-version: ["3.11"]
        module: ${{ fromJson(needs.detect-changes.outputs.matrix).include[*].module }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Python ${{ matrix.python-version }} ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      
      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          cd packages/${{ matrix.module }}
          python -m pip install --upgrade pip
          pip install -e ".[dev]" || pip install -e .

      - name: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: |
          cd packages/${{ matrix.module }}
          pip install pytest pytest-cov
          pytest tests/ -v --cov=src/ --cov-report=xml --cov-report=term || true

  # íŒ¨í‚¤ì§€ ë¹Œë“œ
  build:
    name: "íŒ¨í‚¤ì§€ ë¹Œë“œ"
    runs-on: ubuntu-latest
    needs: [detect-changes, test]
    if: needs.detect-changes.outputs.has-changes == 'true'
    strategy:
      matrix: ${{ fromJson(needs.detect-changes.outputs.matrix) }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: ë¹Œë“œ ë„êµ¬ ì„¤ì¹˜
        run: |
          python -m pip install --upgrade pip
          pip install build twine

      - name: íŒ¨í‚¤ì§€ ë¹Œë“œ
        run: |
          cd packages/${{ matrix.module }}
          python -m build
          echo "âœ… ${{ matrix.module }} ë¹Œë“œ ì™„ë£Œ"

      - name: ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: dist-${{ matrix.module }}
          path: packages/${{ matrix.module }}/dist/
          retention-days: 7

  # ë¬¸ì„œ ì—…ë°ì´íŠ¸
  documentation:
    name: "ë¬¸ì„œ ì—…ë°ì´íŠ¸"
    runs-on: ubuntu-latest
    needs: [detect-changes, build]
    if: needs.detect-changes.outputs.has-changes == 'true' && github.ref == 'refs/heads/main'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          python -m pip install --upgrade pip
          pip install toml

      - name: ë¬¸ì„œ ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        run: |
          if [ -f "scripts/update-documentation.py" ]; then
            python scripts/update-documentation.py
            echo "ğŸ“š ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ"
          else
            echo "ğŸ“š ë¬¸ì„œ ì—…ë°ì´íŠ¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
          fi

      - name: ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # docs ë””ë ‰í„°ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
          if [ ! -d "docs" ]; then
            mkdir -p docs
            echo "ğŸ“ docs ë””ë ‰í„°ë¦¬ ìƒì„±"
          fi
          
          # Gitì—ì„œ ì¶”ì í•˜ì§€ ì•ŠëŠ” íŒŒì¼ë“¤ í™•ì¸
          if git status --porcelain | grep -q .; then
            git add .
            git commit -m "docs: Update documentation [skip ci]" || echo "ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
            git push || echo "í‘¸ì‹œí•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
            echo "ğŸ“š ë¬¸ì„œ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ"
          else
            echo "ğŸ“š ë¬¸ì„œ ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          fi

  # PyPI ë°°í¬
  deploy:
    name: "PyPI ë°°í¬"
    runs-on: ubuntu-latest
    needs: [detect-changes, build, documentation]
    if: needs.detect-changes.outputs.has-changes == 'true' && github.ref == 'refs/heads/main'
    strategy:
      matrix: ${{ fromJson(needs.detect-changes.outputs.matrix) }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Python í™˜ê²½ ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: ë¹Œë“œ ì•„í‹°íŒ©íŠ¸ ë‹¤ìš´ë¡œë“œ
        uses: actions/download-artifact@v4
        with:
          name: dist-${{ matrix.module }}
          path: packages/${{ matrix.module }}/dist/

      - name: ë²„ì „ ë³€ê²½ í™•ì¸
        id: version-check
        run: |
          cd packages/${{ matrix.module }}
          
          # pyproject.tomlì—ì„œ íŒ¨í‚¤ì§€ëª…ê³¼ ë²„ì „ ì¶”ì¶œ
          if [ -f "pyproject.toml" ]; then
            # grepê³¼ sedë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ¨í‚¤ì§€ëª… ì¶”ì¶œ
            package_name=$(grep '^name\s*=' pyproject.toml | head -n1 | sed 's/.*=\s*["\x27]\([^"\x27]*\)["\x27].*/\1/' | tr -d ' ')
            if [ -z "$package_name" ]; then
              echo "âš ï¸ íŒ¨í‚¤ì§€ëª…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ ì‚¬ìš©: ${{ matrix.module }}"
              package_name="${{ matrix.module }}"
            fi
            
            # ë²„ì „ ì¶”ì¶œ
            current_version=$(grep '^version\s*=' pyproject.toml | head -n1 | sed 's/.*=\s*["\x27]\([^"\x27]*\)["\x27].*/\1/' | tr -d ' ')
            
            echo "ğŸ“¦ íŒ¨í‚¤ì§€ëª…: $package_name"
            echo "ğŸ·ï¸ í˜„ì¬ ë²„ì „: $current_version"
            
            # PyPIì—ì„œ ìµœì‹  ë²„ì „ í™•ì¸
            latest_version=$(pip index versions "$package_name" 2>/dev/null | head -n1 | grep -o '[0-9]\+\.[0-9]\+\.[0-9]\+' | head -n1 || echo "0.0.0")
            echo "ğŸ·ï¸ PyPI ìµœì‹  ë²„ì „: $latest_version"
            
            if [ "$current_version" != "$latest_version" ]; then
              echo "ğŸš€ ìƒˆ ë²„ì „ ê°ì§€: $latest_version -> $current_version"
              echo "should-deploy=true" >> $GITHUB_OUTPUT
              echo "package-name=$package_name" >> $GITHUB_OUTPUT
              echo "version=$current_version" >> $GITHUB_OUTPUT
            else
              echo "ğŸ“‹ ë²„ì „ ë³€ê²½ ì—†ìŒ: $current_version"
              echo "should-deploy=false" >> $GITHUB_OUTPUT
            fi
          else
            echo "âŒ pyproject.toml íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            echo "should-deploy=false" >> $GITHUB_OUTPUT
          fi

      - name: PyPIì— ë°°í¬
        if: steps.version-check.outputs.should-deploy == 'true'
        run: |
          cd packages/${{ matrix.module }}
          pip install twine
          python -m twine upload dist/* --username __token__ --password ${{ secrets.PYPI_API_TOKEN }} --skip-existing
          echo "ğŸš€ ${{ steps.version-check.outputs.package-name }} v${{ steps.version-check.outputs.version }} PyPI ë°°í¬ ì™„ë£Œ"

  # ì•Œë¦¼
  notification:
    name: "ì•Œë¦¼"
    runs-on: ubuntu-latest
    needs: [detect-changes, quality-check, test, build, documentation, deploy]
    if: always() && needs.detect-changes.outputs.has-changes == 'true'
    
    steps:
      - name: ì„±ê³µ ì•Œë¦¼
        if: needs.deploy.result == 'success'
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "text": "ğŸš€ Universal Modules ë°°í¬ ì„±ê³µ!",
                "blocks": [
                  {
                    "type": "header",
                    "text": {
                      "type": "plain_text",
                      "text": "ğŸš€ ë°°í¬ ì„±ê³µ"
                    }
                  },
                  {
                    "type": "section",
                    "fields": [
                      {
                        "type": "mrkdwn",
                        "text": "*ë°°í¬ëœ ëª¨ë“ˆ:*\n${{ needs.detect-changes.outputs.changed-modules }}"
                      },
                      {
                        "type": "mrkdwn",
                        "text": "*ë¸Œëœì¹˜:*\n${{ github.ref_name }}"
                      },
                      {
                        "type": "mrkdwn",
                        "text": "*ì»¤ë°‹:*\n<${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}|${{ github.sha }}>"
                      },
                      {
                        "type": "mrkdwn",
                        "text": "*ì‘ì„±ì:*\n${{ github.actor }}"
                      }
                    ]
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {
                          "type": "plain_text",
                          "text": "PyPIì—ì„œ í™•ì¸í•˜ê¸°"
                        },
                        "url": "https://pypi.org/user/yeonjae0901/"
                      }
                    ]
                  }
                ]
              }' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
          else
            echo "SLACK_WEBHOOK_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ Slack ì•Œë¦¼ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

      - name: í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì•Œë¦¼
        if: needs.test.result == 'failure'
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "text": "âŒ Universal Modules í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!",
                "blocks": [
                  {
                    "type": "header",
                    "text": {
                      "type": "plain_text",
                      "text": "âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
                    }
                  },
                  {
                    "type": "section",
                    "text": {
                      "type": "mrkdwn",
                      "text": "*ëª¨ë“ˆ:* ${{ needs.detect-changes.outputs.changed-modules }}\n*ë¸Œëœì¹˜:* ${{ github.ref_name }}\n*ì‘ì„±ì:* ${{ github.actor }}"
                    }
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {
                          "type": "plain_text",
                          "text": "í…ŒìŠ¤íŠ¸ ë¡œê·¸ ë³´ê¸°"
                        },
                        "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                        "style": "danger"
                      }
                    ]
                  }
                ]
              }' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
          else
            echo "SLACK_WEBHOOK_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ Slack ì•Œë¦¼ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

      - name: ë¹Œë“œ ì‹¤íŒ¨ ì•Œë¦¼
        if: needs.build.result == 'failure'
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "text": "ğŸ”¨ Universal Modules ë¹Œë“œ ì‹¤íŒ¨!",
                "blocks": [
                  {
                    "type": "header",
                    "text": {
                      "type": "plain_text",
                      "text": "ğŸ”¨ ë¹Œë“œ ì‹¤íŒ¨"
                    }
                  },
                  {
                    "type": "section",
                    "text": {
                      "type": "mrkdwn",
                      "text": "*ëª¨ë“ˆ:* ${{ needs.detect-changes.outputs.changed-modules }}\n*ë¸Œëœì¹˜:* ${{ github.ref_name }}\n*ì‘ì„±ì:* ${{ github.actor }}"
                    }
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {
                          "type": "plain_text",
                          "text": "ë¹Œë“œ ë¡œê·¸ ë³´ê¸°"
                        },
                        "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                        "style": "danger"
                      }
                    ]
                  }
                ]
              }' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
          else
            echo "SLACK_WEBHOOK_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ Slack ì•Œë¦¼ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

      - name: ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì•Œë¦¼
        if: needs.documentation.result == 'failure'
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "text": "ğŸ“š Universal Modules ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨!",
                "blocks": [
                  {
                    "type": "header",
                    "text": {
                      "type": "plain_text",
                      "text": "ğŸ“š ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨"
                    }
                  },
                  {
                    "type": "section",
                    "text": {
                      "type": "mrkdwn",
                      "text": "*ëª¨ë“ˆ:* ${{ needs.detect-changes.outputs.changed-modules }}\n*ë¸Œëœì¹˜:* ${{ github.ref_name }}\n*ì‘ì„±ì:* ${{ github.actor }}"
                    }
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {
                          "type": "plain_text",
                          "text": "ë¬¸ì„œ ë¡œê·¸ ë³´ê¸°"
                        },
                        "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                        "style": "primary"
                      }
                    ]
                  }
                ]
              }' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
          else
            echo "SLACK_WEBHOOK_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ Slack ì•Œë¦¼ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

      - name: ë°°í¬ ì‹¤íŒ¨ ì•Œë¦¼
        if: needs.deploy.result == 'failure'
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "text": "âŒ Universal Modules ë°°í¬ ì‹¤íŒ¨!",
                "blocks": [
                  {
                    "type": "header",
                    "text": {
                      "type": "plain_text",
                      "text": "âŒ ë°°í¬ ì‹¤íŒ¨"
                    }
                  },
                  {
                    "type": "section",
                    "fields": [
                      {
                        "type": "mrkdwn",
                        "text": "*ì‹¤íŒ¨í•œ ëª¨ë“ˆ:*\n${{ needs.detect-changes.outputs.changed-modules }}"
                      },
                      {
                        "type": "mrkdwn",
                        "text": "*ë¸Œëœì¹˜:*\n${{ github.ref_name }}"
                      },
                      {
                        "type": "mrkdwn",
                        "text": "*ì»¤ë°‹:*\n<${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}|${{ github.sha }}>"
                      },
                      {
                        "type": "mrkdwn",
                        "text": "*ì‘ì„±ì:*\n${{ github.actor }}"
                      }
                    ]
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {
                          "type": "plain_text",
                          "text": "ë¡œê·¸ í™•ì¸í•˜ê¸°"
                        },
                        "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                        "style": "danger"
                      }
                    ]
                  }
                ]
              }' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
          else
            echo "SLACK_WEBHOOK_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ Slack ì•Œë¦¼ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi

      - name: ì „ì²´ ì›Œí¬í”Œë¡œìš° ì„±ê³µ ì•Œë¦¼
        if: needs.deploy.result == 'skipped' && !contains(needs.*.result, 'failure')
        run: |
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data '{
                "text": "âœ… Universal Modules ì²˜ë¦¬ ì™„ë£Œ (ë°°í¬ ì—†ìŒ)",
                "blocks": [
                  {
                    "type": "header",
                    "text": {
                      "type": "plain_text",
                      "text": "âœ… ì²˜ë¦¬ ì™„ë£Œ"
                    }
                  },
                  {
                    "type": "section",
                    "text": {
                      "type": "mrkdwn",
                      "text": "*ëª¨ë“ˆ:* ${{ needs.detect-changes.outputs.changed-modules }}\n*ìƒíƒœ:* í…ŒìŠ¤íŠ¸/ë¹Œë“œ ì„±ê³µ, ë²„ì „ ë³€ê²½ ì—†ì–´ ë°°í¬ ìŠ¤í‚µ\n*ë¸Œëœì¹˜:* ${{ github.ref_name }}\n*ì‘ì„±ì:* ${{ github.actor }}"
                    }
                  },
                  {
                    "type": "actions",
                    "elements": [
                      {
                        "type": "button",
                        "text": {
                          "type": "plain_text",
                          "text": "ì›Œí¬í”Œë¡œìš° ë¡œê·¸ ë³´ê¸°"
                        },
                        "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                      }
                    ]
                  }
                ]
              }' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
          else
            echo "SLACK_WEBHOOK_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•„ Slack ì•Œë¦¼ì„ ê±´ë„ˆëœë‹ˆë‹¤."
          fi 